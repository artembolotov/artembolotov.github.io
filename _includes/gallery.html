{% comment %}
Improved Image gallery component with width/height support
Usage: 
{% include gallery.html images=gallery_test id="custom_id" %}

Formats supported:
- /path/image.jpg|Alt text
- /path/image.jpg|Alt text|800|600
- /path/image.jpg (alt will be empty)
{% endcomment %}

{% if include.id %}
  {% assign gallery_id = include.id %}
{% else %}
  {% assign gallery_id = 'gallery-auto' %}
{% endif %}

<div class="image-gallery" data-gallery-id="{{ gallery_id }}">
  {% assign lines = include.images | strip | split: "
" %}
  {% assign image_count = 0 %}
  {% for line in lines %}
    {% assign trimmed_line = line | strip %}
    {% unless trimmed_line == "" %}
      {% assign image_count = image_count | plus: 1 %}
    {% endunless %}
  {% endfor %}
  
  <div class="image-gallery-inner" data-count="{{ image_count }}">
    {% for line in lines %}
      {% assign trimmed_line = line | strip %}
      {% unless trimmed_line == "" %}
        {% assign parts = trimmed_line | split: "|" %}
        {% assign image_path = parts[0] | strip %}
        {% assign image_alt = parts[1] | strip | default: "" %}
        {% assign image_width = parts[2] | strip | default: "" %}
        {% assign image_height = parts[3] | strip | default: "" %}
        
        {% comment %}Generate img tag with or without dimensions{% endcomment %}
        {% if image_width != "" and image_height != "" %}
          <img src="{{ image_path }}" alt="{{ image_alt }}" width="{{ image_width }}" height="{{ image_height }}">
        {% else %}
          <img src="{{ image_path }}" alt="{{ image_alt }}">
        {% endif %}
      {% endunless %}
    {% endfor %}
  </div>
  
  {% if image_count > 1 %}
  <div class="gallery-controls">
    <button class="gallery-nav gallery-prev" data-gallery="{{ gallery_id }}" data-direction="prev" aria-label="Предыдущее изображение">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15 18 9 12 15 6"></polyline>
      </svg>
    </button>
    <button class="gallery-nav gallery-next" data-gallery="{{ gallery_id }}" data-direction="next" aria-label="Следующее изображение">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="9 18 15 12 9 6"></polyline>
      </svg>
    </button>
  </div>
  {% endif %}
</div>